000007883O:8:"stdClass":26:{s:7:"process";a:28:{s:7:"PRO_UID";s:32:"51139890850c52522d53dd5003076507";s:10:"PRO_PARENT";s:32:"51139890850c52522d53dd5003076507";s:8:"PRO_TIME";d:1;s:12:"PRO_TIMEUNIT";s:4:"DAYS";s:10:"PRO_STATUS";s:6:"ACTIVE";s:12:"PRO_TYPE_DAY";s:0:"";s:8:"PRO_TYPE";s:6:"NORMAL";s:14:"PRO_ASSIGNMENT";s:5:"FALSE";s:12:"PRO_SHOW_MAP";i:0;s:16:"PRO_SHOW_MESSAGE";i:0;s:17:"PRO_SHOW_DELEGATE";i:0;s:17:"PRO_SHOW_DYNAFORM";i:0;s:12:"PRO_CATEGORY";s:0:"";s:16:"PRO_SUB_CATEGORY";s:0:"";s:12:"PRO_INDUSTRY";i:0;s:15:"PRO_UPDATE_DATE";N;s:15:"PRO_CREATE_DATE";s:19:"2012-12-09 18:56:18";s:15:"PRO_CREATE_USER";s:32:"00000000000000000000000000000001";s:10:"PRO_HEIGHT";i:5000;s:9:"PRO_WIDTH";i:10000;s:11:"PRO_TITLE_X";i:0;s:11:"PRO_TITLE_Y";i:0;s:9:"PRO_DEBUG";i:0;s:13:"PRO_DYNAFORMS";b:0;s:25:"PRO_DERIVATION_SCREEN_TPL";s:0:"";s:15:"PRO_DESCRIPTION";s:0:"";s:9:"PRO_TITLE";s:16:"Process Webentry";s:18:"PRO_CATEGORY_LABEL";s:11:"No Category";}s:5:"tasks";a:2:{i:0;a:48:{s:7:"PRO_UID";s:32:"51139890850c52522d53dd5003076507";s:7:"TAS_UID";s:32:"85327914050c5253c69aa76003277285";s:8:"TAS_TYPE";s:6:"NORMAL";s:12:"TAS_DURATION";d:1;s:14:"TAS_DELAY_TYPE";s:0:"";s:14:"TAS_TEMPORIZER";d:0;s:12:"TAS_TYPE_DAY";s:0:"";s:12:"TAS_TIMEUNIT";s:4:"DAYS";s:9:"TAS_ALERT";s:5:"FALSE";s:21:"TAS_PRIORITY_VARIABLE";s:0:"";s:15:"TAS_ASSIGN_TYPE";s:8:"BALANCED";s:19:"TAS_ASSIGN_VARIABLE";s:30:"@@SYS_NEXT_USER_TO_BE_ASSIGNED";s:24:"TAS_MI_INSTANCE_VARIABLE";s:24:"@@SYS_VAR_TOTAL_INSTANCE";s:24:"TAS_MI_COMPLETE_VARIABLE";s:34:"@@SYS_VAR_TOTAL_INSTANCES_COMPLETE";s:19:"TAS_ASSIGN_LOCATION";s:5:"FALSE";s:25:"TAS_ASSIGN_LOCATION_ADHOC";s:5:"FALSE";s:16:"TAS_TRANSFER_FLY";s:5:"FALSE";s:17:"TAS_LAST_ASSIGNED";s:32:"00000000000000000000000000000001";s:8:"TAS_USER";s:1:"0";s:14:"TAS_CAN_UPLOAD";s:5:"FALSE";s:15:"TAS_VIEW_UPLOAD";s:5:"FALSE";s:33:"TAS_VIEW_ADDITIONAL_DOCUMENTATION";s:5:"FALSE";s:14:"TAS_CAN_CANCEL";s:5:"FALSE";s:13:"TAS_OWNER_APP";s:5:"FALSE";s:7:"STG_UID";s:0:"";s:13:"TAS_CAN_PAUSE";s:5:"FALSE";s:20:"TAS_CAN_SEND_MESSAGE";s:4:"TRUE";s:19:"TAS_CAN_DELETE_DOCS";s:5:"FALSE";s:16:"TAS_SELF_SERVICE";s:5:"FALSE";s:9:"TAS_START";s:4:"TRUE";s:16:"TAS_TO_LAST_USER";s:5:"FALSE";s:19:"TAS_SEND_LAST_EMAIL";s:5:"FALSE";s:14:"TAS_DERIVATION";s:6:"NORMAL";s:8:"TAS_POSX";i:524;s:8:"TAS_POSY";i:146;s:9:"TAS_WIDTH";i:165;s:10:"TAS_HEIGHT";i:40;s:9:"TAS_COLOR";s:0:"";s:11:"TAS_EVN_UID";s:0:"";s:12:"TAS_BOUNDARY";s:0:"";s:25:"TAS_DERIVATION_SCREEN_TPL";s:0:"";s:9:"TAS_TITLE";s:6:"Task 1";s:15:"TAS_DESCRIPTION";s:0:"";s:13:"TAS_DEF_TITLE";s:0:"";s:19:"TAS_DEF_DESCRIPTION";s:0:"";s:17:"TAS_DEF_PROC_CODE";s:0:"";s:15:"TAS_DEF_MESSAGE";s:0:"";s:23:"TAS_DEF_SUBJECT_MESSAGE";s:0:"";}i:1;a:48:{s:7:"PRO_UID";s:32:"51139890850c52522d53dd5003076507";s:7:"TAS_UID";s:32:"88449217350c525452f35e1076502390";s:8:"TAS_TYPE";s:6:"NORMAL";s:12:"TAS_DURATION";d:1;s:14:"TAS_DELAY_TYPE";s:0:"";s:14:"TAS_TEMPORIZER";d:0;s:12:"TAS_TYPE_DAY";s:0:"";s:12:"TAS_TIMEUNIT";s:4:"DAYS";s:9:"TAS_ALERT";s:5:"FALSE";s:21:"TAS_PRIORITY_VARIABLE";s:0:"";s:15:"TAS_ASSIGN_TYPE";s:8:"BALANCED";s:19:"TAS_ASSIGN_VARIABLE";s:30:"@@SYS_NEXT_USER_TO_BE_ASSIGNED";s:24:"TAS_MI_INSTANCE_VARIABLE";s:24:"@@SYS_VAR_TOTAL_INSTANCE";s:24:"TAS_MI_COMPLETE_VARIABLE";s:34:"@@SYS_VAR_TOTAL_INSTANCES_COMPLETE";s:19:"TAS_ASSIGN_LOCATION";s:5:"FALSE";s:25:"TAS_ASSIGN_LOCATION_ADHOC";s:5:"FALSE";s:16:"TAS_TRANSFER_FLY";s:5:"FALSE";s:17:"TAS_LAST_ASSIGNED";s:32:"00000000000000000000000000000001";s:8:"TAS_USER";s:1:"0";s:14:"TAS_CAN_UPLOAD";s:5:"FALSE";s:15:"TAS_VIEW_UPLOAD";s:5:"FALSE";s:33:"TAS_VIEW_ADDITIONAL_DOCUMENTATION";s:5:"FALSE";s:14:"TAS_CAN_CANCEL";s:5:"FALSE";s:13:"TAS_OWNER_APP";s:5:"FALSE";s:7:"STG_UID";s:0:"";s:13:"TAS_CAN_PAUSE";s:5:"FALSE";s:20:"TAS_CAN_SEND_MESSAGE";s:4:"TRUE";s:19:"TAS_CAN_DELETE_DOCS";s:5:"FALSE";s:16:"TAS_SELF_SERVICE";s:5:"FALSE";s:9:"TAS_START";s:5:"FALSE";s:16:"TAS_TO_LAST_USER";s:5:"FALSE";s:19:"TAS_SEND_LAST_EMAIL";s:5:"FALSE";s:14:"TAS_DERIVATION";s:6:"NORMAL";s:8:"TAS_POSX";i:523;s:8:"TAS_POSY";i:251;s:9:"TAS_WIDTH";i:165;s:10:"TAS_HEIGHT";i:40;s:9:"TAS_COLOR";s:0:"";s:11:"TAS_EVN_UID";s:0:"";s:12:"TAS_BOUNDARY";s:0:"";s:25:"TAS_DERIVATION_SCREEN_TPL";s:0:"";s:9:"TAS_TITLE";s:6:"Task 2";s:15:"TAS_DESCRIPTION";s:0:"";s:13:"TAS_DEF_TITLE";s:0:"";s:19:"TAS_DEF_DESCRIPTION";s:0:"";s:17:"TAS_DEF_PROC_CODE";s:0:"";s:15:"TAS_DEF_MESSAGE";s:0:"";s:23:"TAS_DEF_SUBJECT_MESSAGE";s:0:"";}}s:6:"routes";a:2:{i:0;a:17:{s:7:"ROU_UID";s:32:"97125244150c5e3dd190fe6096160633";s:10:"ROU_PARENT";s:1:"0";s:7:"PRO_UID";s:32:"51139890850c52522d53dd5003076507";s:7:"TAS_UID";s:32:"88449217350c525452f35e1076502390";s:13:"ROU_NEXT_TASK";s:2:"-1";s:8:"ROU_CASE";s:1:"1";s:8:"ROU_TYPE";s:10:"SEQUENTIAL";s:13:"ROU_CONDITION";s:0:"";s:16:"ROU_TO_LAST_USER";s:5:"FALSE";s:12:"ROU_OPTIONAL";s:5:"FALSE";s:14:"ROU_SEND_EMAIL";s:4:"TRUE";s:16:"ROU_SOURCEANCHOR";s:1:"1";s:16:"ROU_TARGETANCHOR";s:1:"0";s:11:"ROU_TO_PORT";s:1:"1";s:13:"ROU_FROM_PORT";s:1:"2";s:11:"ROU_EVN_UID";s:32:"61380004850c5e3dd378af9045047849";s:7:"GAT_UID";s:0:"";}i:1;a:17:{s:7:"ROU_UID";s:32:"41165161150c5e3dd3a5b50053362339";s:10:"ROU_PARENT";s:1:"0";s:7:"PRO_UID";s:32:"51139890850c52522d53dd5003076507";s:7:"TAS_UID";s:32:"85327914050c5253c69aa76003277285";s:13:"ROU_NEXT_TASK";s:32:"88449217350c525452f35e1076502390";s:8:"ROU_CASE";s:1:"1";s:8:"ROU_TYPE";s:10:"SEQUENTIAL";s:13:"ROU_CONDITION";s:0:"";s:16:"ROU_TO_LAST_USER";s:5:"FALSE";s:12:"ROU_OPTIONAL";s:5:"FALSE";s:14:"ROU_SEND_EMAIL";s:4:"TRUE";s:16:"ROU_SOURCEANCHOR";s:1:"1";s:16:"ROU_TARGETANCHOR";s:1:"0";s:11:"ROU_TO_PORT";s:1:"1";s:13:"ROU_FROM_PORT";s:1:"2";s:11:"ROU_EVN_UID";s:0:"";s:7:"GAT_UID";s:0:"";}}s:5:"lanes";a:0:{}s:8:"gateways";a:0:{}s:6:"inputs";a:0:{}s:7:"outputs";a:0:{}s:9:"dynaforms";a:1:{i:0;a:6:{s:7:"DYN_UID";s:32:"96494342250c525833edc60007458301";s:7:"PRO_UID";s:32:"51139890850c52522d53dd5003076507";s:8:"DYN_TYPE";s:7:"xmlform";s:12:"DYN_FILENAME";s:65:"51139890850c52522d53dd5003076507/96494342250c525833edc60007458301";s:9:"DYN_TITLE";s:7:"WebForm";s:15:"DYN_DESCRIPTION";s:0:"";}}s:5:"steps";a:2:{i:0;a:8:{s:8:"STEP_UID";s:32:"68599201650c525f9b09273021256226";s:7:"PRO_UID";s:32:"51139890850c52522d53dd5003076507";s:7:"TAS_UID";s:32:"85327914050c5253c69aa76003277285";s:13:"STEP_TYPE_OBJ";s:8:"DYNAFORM";s:12:"STEP_UID_OBJ";s:32:"96494342250c525833edc60007458301";s:14:"STEP_CONDITION";s:0:"";s:13:"STEP_POSITION";i:1;s:9:"STEP_MODE";s:4:"EDIT";}i:1;a:8:{s:8:"STEP_UID";s:32:"70401961250c526038a11c1029939295";s:7:"PRO_UID";s:32:"51139890850c52522d53dd5003076507";s:7:"TAS_UID";s:32:"88449217350c525452f35e1076502390";s:13:"STEP_TYPE_OBJ";s:8:"DYNAFORM";s:12:"STEP_UID_OBJ";s:32:"96494342250c525833edc60007458301";s:14:"STEP_CONDITION";s:0:"";s:13:"STEP_POSITION";i:1;s:9:"STEP_MODE";s:4:"VIEW";}}s:8:"triggers";a:0:{}s:9:"taskusers";a:0:{}s:8:"groupwfs";a:0:{}s:12:"steptriggers";a:0:{}s:13:"dbconnections";a:0:{}s:12:"reportTables";a:0:{}s:16:"reportTablesVars";a:0:{}s:14:"stepSupervisor";a:0:{}s:17:"objectPermissions";a:0:{}s:10:"subProcess";a:0:{}s:11:"caseTracker";a:0:{}s:17:"caseTrackerObject";a:0:{}s:5:"stage";a:0:{}s:14:"fieldCondition";a:0:{}s:5:"event";a:1:{i:0;a:21:{s:7:"EVN_UID";s:32:"61380004850c5e3dd378af9045047849";s:7:"PRO_UID";s:32:"51139890850c52522d53dd5003076507";s:10:"EVN_STATUS";s:6:"ACTIVE";s:15:"EVN_WHEN_OCCURS";s:6:"SINGLE";s:14:"EVN_RELATED_TO";s:8:"MULTIPLE";s:7:"TAS_UID";s:0:"";s:16:"EVN_TAS_UID_FROM";s:32:"88449217350c525452f35e1076502390";s:14:"EVN_TAS_UID_TO";s:0:"";s:26:"EVN_TAS_ESTIMATED_DURATION";d:0;s:13:"EVN_TIME_UNIT";s:4:"DAYS";s:8:"EVN_WHEN";d:1;s:16:"EVN_MAX_ATTEMPTS";i:3;s:10:"EVN_ACTION";s:0:"";s:14:"EVN_CONDITIONS";N;s:21:"EVN_ACTION_PARAMETERS";b:0;s:7:"TRI_UID";s:0:"";s:8:"EVN_POSX";i:606;s:8:"EVN_POSY";i:384;s:8:"EVN_TYPE";s:17:"bpmnEventEmptyEnd";s:11:"TAS_EVN_UID";s:0:"";s:15:"EVN_DESCRIPTION";s:0:"";}}s:13:"caseScheduler";a:0:{}s:15:"processCategory";N;}00000003296494342250c525833edc60007458301000000537<?xml version="1.0" encoding="UTF-8"?>
<dynaForm type="xmlform" name="51139890850c52522d53dd5003076507/96494342250c525833edc60007458301" width="500" enabletemplate="0" mode="" nextstepsave="prompt">
  <NAME type="text" maxlength="64" validate="Any" required="0" readonly="0" size="15" mode="edit">
    <en>Name</en>
  </NAME>
  <LAST_NAME type="text" maxlength="64" validate="Any" required="0" readonly="0" size="15" mode="edit">
    <en>Last Name</en>
  </LAST_NAME>
  <Submit type="submit">
    <en>Submit</en>
  </Submit>
</dynaForm>
PUBLIC   000000011WebForm.php000000410<?php
global $_DBArray;
if (!isset($_DBArray)) {
  $_DBArray = array();
}
$_SESSION['PROCESS'] = '51139890850c52522d53dd5003076507';
$_SESSION['CURRENT_DYN_UID'] = '96494342250c525833edc60007458301';
$G_PUBLISH = new Publisher;
$G_PUBLISH->AddContent('dynaform', 'xmlform', '51139890850c52522d53dd5003076507/96494342250c525833edc60007458301', '', array(), 'WebFormPost.php');
G::RenderPage('publish', 'blank');000000015WebFormPost.php000004296<?php
 /***********************************************************************************************
  *                        --= Processmaker Web Entry Request handler =--                       * 
  *                                                                                             *
  *             This file was autogenerated by Processmaker Open Source  Rel-2.0.45               *
  **********************************************************************************************/
   
  #@Dynaform  : WebForm
  #@Workspace : wsqa                                                                       
  #@Timestamp : Monday 10th of December 2012 09:32:17 AM                                                                                                                                                                                                     
   
  define ( 'WS_WSDL_URL',     'http://192.168.11.152/syswsqa/en/classic/services/wsdl2' );
  define ( 'WS_UPLOAD_URL',   'http://192.168.11.152/syswsqa/en/classic/services/upload' );
  define ( 'WS_USER_ID',      'admin' );
  define ( 'WS_USER_PASS',    'md5:21232f297a57a5a743894a0e4a801fc3' );
  define ( 'WS_ROUNDROBIN',   '0' ); 

  try {
    @include_once ( "wsClient.php" );
    
    if ( !function_exists('ws_open') ){
      throw ( new Exception ('function ws_open() is not defined.  File wsClient.php is missing') );
    }
    $oForm = new Form ( '51139890850c52522d53dd5003076507' . '/' . '96494342250c525833edc60007458301', PATH_DYNAFORM );
    $oForm->validatePost();

    ws_open ();
    $result = ws_newCase ( '51139890850c52522d53dd5003076507', '85327914050c5253c69aa76003277285', convertFormToWSObjects($_POST['form']) );
    
    if ($result->status_code == 0) {
      $caseId = $result->caseId;
      $caseNr = $result->caseNumber;
      
      $USR_UID = -1;
      
      if ($USR_UID == -1) {
        G::LoadClass("sessions");
        
        global $sessionId;
        
        $sessions = new Sessions();
        $session  = $sessions->getSessionUser($sessionId);
        
        $USR_UID = $session["USR_UID"];
      }
      
      //Save files
      if ( isset($_FILES['form']) ) {
        foreach ($_FILES['form']['name'] as $sFieldName => $vValue) {
          if ( $_FILES['form']['error'][$sFieldName] == 0 ){
            file_put_contents(G::sys_get_temp_dir().PATH_SEP.$_FILES['form']['name'][$sFieldName], file_get_contents($_FILES['form']['tmp_name'][$sFieldName]));
            $fpath = G::sys_get_temp_dir().PATH_SEP.$_FILES['form']['name'][$sFieldName];
            
            if( isset($_POST['INPUTS'][$sFieldName]) && $_POST['INPUTS'][$sFieldName] != '' ){ #input file type
              ws_sendFile($fpath, $USR_UID, $caseId, 1, $_POST['INPUTS'][$sFieldName]);
            } else { #attached file type
              ws_sendFile($fpath, $USR_UID, $caseId);
            }
          }
        }
      }
      
      $result = ws_routeCase ($caseId, 1);
      $assign = $result->message;
    
      $aMessage['MESSAGE'] = "<br/>Case created in ProcessMaker<br/>Case Number:$caseNr <br/>Case Id:$caseId<br/>Case derivated to: $assign";
      
    } else {
      $aMessage['MESSAGE'] = '<font color="red">An error occurred while the application was being processed.<br/>
                              Error code: '.$result->status_code.'<br/>
                              Error message: '.$result->message.'</font><br/><br/>
                              <b>please contact to your system administrator.</b>';
    }
  
    /**
    * by default show the case info, for the recently created case
    * you can change it or redirect to another page 
    * i.e. G::header( 'Location: http://www.processmaker.com' );
    */
  $G_PUBLISH = new Publisher;
  $G_PUBLISH->AddContent('xmlform', 'xmlform', 'login/showInfo', '', $aMessage );
  G::RenderPage( 'publish', 'blank' );
  }
  catch ( Exception $e ) {
    $G_PUBLISH = new Publisher;
    $suggest_message = "This web entry should be regenerated, please contact to your system administrator.";
    $aMessage['MESSAGE'] = '<font color=\'red\'><pre>'.$e->getMessage().'</pre>'.$suggest_message .'</font>';
    $G_PUBLISH->AddContent('xmlform', 'xmlform', 'login/showMessage', '', $aMessage );
    G::RenderPage( 'publish', 'blank' );
  }000000012wsClient.php000015667<?php
ini_set("soap.wsdl_cache_enabled", "1"); // enabling WSDL cache


function parseItemArray($array) {
  if (! isset($array->item) && ! is_array($array)) {
    return null;
  }
  
  $result = array ();
  if (isset($array->item)) {
    foreach ( $array->item as $key => $value ) {
      $result[$value->key] = $value->value;
    }
  } else {
    foreach ( $array as $key => $value ) {
      $result[$value->key] = $value->value;
    }
  }
  return $result;
}

/**
 * function convertFormToWSObjects
 * @param $form
 * Convert a normal POST form into the correspondent valid structure for webservice
 * @return array of objects
 */
function convertFormToWSObjects($form) {
  
  foreach ( $form as $key => $val ) {
    if (! is_array($val)) { //Normal Variables
      $obj = new stdClass();
      $obj->name = $key;
      $obj->value = $val;
      $aVariables[] = $obj;
    } else {
      foreach ( $val as $gridKey => $gridRow ) { //Sp�cial Variables like grids or checkgroups
        if (is_array($gridRow)) { //Grids
          foreach ( $gridRow as $col => $colValue ) {
            $obj = new stdClass();
            $obj->name = $key . "][" . $gridKey . "][" . $col;
            $obj->value = $colValue;
            $aVariables[] = $obj;
          }
        } else { //Checkgroups, Radiogroups
          $obj = new stdClass();
          $obj->name = $key;
          $obj->value = implode("|", $val);
          $aVariables[] = $obj;
        }
      }
    }
  }
  
  return $aVariables;
}

//this function is not necesary for version 2 of PM webservices
function convertSoapArrayToArray($object) {
  $result = array ();
  $properties = get_object_vars($object);
  
  foreach ( $properties as $keyProperties => $valProperties ) {
    $array = array ();
    foreach ( $valProperties as $keyItems => $valItems ) {
      $node = array ();
      if (isset($valItems->item)) {
        foreach ( $valItems->item as $keyNode => $valNode ) {
          $node[$valNode->key] = $valNode->value;
        }
      }
      if (is_array($valItems)) {
        foreach ( $valItems as $keyNode => $valNode ) {
          $node[$valNode->key] = $valNode->value;
        }
      }
      $array[] = $node;
    }
    $result[$keyProperties] = $array;
  }
  return $result;
}

function ws_parser($result) {
  $rows = array ();
  if (isset($result->derivation))
    if (is_array($result->derivation->item)) {
      foreach ( $result->derivation->item as $index => $val ) {
        $rows[$val->key] = $val->value;
      }
    } else {
      $rows[$result->derivation->item->key] = $result->derivation->item->value;
    }
  
  return $rows;
}

function ws_open() {
  global $sessionId;
  global $client;
  $endpoint = WS_WSDL_URL;
  $sessionId = '';
  @$client = new SoapClient($endpoint);
  
  $user = WS_USER_ID;
  $pass = WS_USER_PASS;
  
  $params = array (
    'userid' => $user,
    'password' => $pass
  );
  $result = $client->__SoapCall('login', array (
    $params
  ));
  
  if ($result->status_code == 0) {
    $sessionId = $result->message;
    return 1;
  }
  throw (new Exception($result->message));
}

function ws_open_with_params($endpoint, $user, $pass) {
  global $sessionId;
  global $client;
  $sessionId = '';
  @$client = new SoapClient($endpoint);
  
  $params = array (
    'userid' => $user,
    'password' => $pass
  );
  $result = $client->__SoapCall('login', array (
    $params
  ));
  
  if ($result->status_code == 0) {
    $sessionId = $result->message;
    return 1;
  }
  throw (new Exception($result->message));
}

function ws_sendEmailMessage($caseId, $toEmail, $sSubject, $ccEmail, $bccEmail, $sBody) {
  global $sessionId;
  global $client;
  $params = array (
    'sessionId' => $sessionId,
    'caseId' => $caseId,
    'from' => 'soporte <support@colosa.com>',
    'to' => $toEmail,
    'cc' => $ccEmail,
    'bcc' => $bccEmail,
    'subject' => $sSubject,
    'message' => $sBody
  );
  $result = $client->__SoapCall('sendMessage', array (
    $params
  ));
  return $result;
}

function ws_sendMessage($caseId, $toEmail, $sSubject, $ccEmail, $bccEmail, $template) {
  global $sessionId;
  global $client;
  $params = array (
    'sessionId' => $sessionId,
    'caseId' => $caseId,
    'from' => 'soporte <support@colosa.com>',
    'to' => $toEmail,
    'cc' => $ccEmail,
    'bcc' => $bccEmail,
    'subject' => $sSubject,
    'message' => $template
  );
  $result = $client->__SoapCall('sendMessage', array (
    $params
  ));
  return $result;
}

function ws_getVariables($caseId, $variables) {
  global $sessionId;
  global $client;
  
  $aVariables = array ();
  foreach ( $variables as $key => $val ) {
    $obj = new stdClass();
    $obj->name = $val;
    $aVariables[] = $obj;
  }
  
  $params = array (
    'sessionId' => $sessionId,
    'caseId' => $caseId,
    'variables' => $aVariables
  );
  $result = $client->__SoapCall('getVariables', array (
    $params
  ));
  return $result;
}

function ws_newCase($proUid, $taskUid, $variables) {
  global $sessionId;
  global $client;
  
  $params = array (
    'sessionId' => $sessionId,
    'processId' => $proUid,
    'taskId' => $taskUid,
    'variables' => $variables
  );
  
  $result = $client->__SoapCall('newCase', array (
    $params
  ));
  
  return $result;
}

function ws_sendVariables($caseId, $variables) {
  global $sessionId;
  global $client;
  
  $params = array (
    'sessionId' => $sessionId,
    'caseId' => $caseId,
    'variables' => $variables
  );
  $result = $client->__SoapCall('sendVariables', array (
    $params
  ));
  
  return $result;
}

function ws_executeTrigger($caseId, $triggerId, $delIndex) {
  global $sessionId;
  global $client;
  
  $params = array (
    'sessionId' => $sessionId,
    'caseId' => $caseId,
    'triggerIndex' => $triggerId,
    'delIndex' => $delIndex
  );
  $result = $client->__SoapCall('executeTrigger', array (
    $params
  ));
  return $result;
}

//only for backward compatibility
function ws_derivateCase($caseId, $delId) {
  global $sessionId;
  global $client;
  
  $rows = array ();
  $params = array (
    'sessionId' => $sessionId,
    'caseId' => $caseId,
    'delIndex' => $delId
  );
  $result = $client->__SoapCall('derivateCase', array (
    $params
  ));
  $rows = ws_parser($result);
  
  $result->derivation = $rows;
  //print_r($result);
  return $result;
}

function ws_routeCase($caseId, $delId) {
  global $sessionId;
  global $client;
  
  $rows = array ();
  $params = array (
    'sessionId' => $sessionId,
    'caseId' => $caseId,
    'delIndex' => $delId
  );
  $result = $client->__SoapCall('routeCase', array (
    $params
  ));
  return $result;
}

function ws_processList() {
  global $sessionId;
  global $client;
  
  $params = array (
    'sessionId' => $sessionId
  );
  $result = $client->__SoapCall('processList', array (
    $params
  ));
  //if ( $result->status_code == 0 ) {
  return $result;
  //}
//throw ( new Exception ( $result->message ) );
}

function ws_groupList() {
  global $sessionId;
  global $client;
  
  $params = array (
    'sessionId' => $sessionId
  );
  $result = $client->__SoapCall('groupList', array (
    $params
  ));
  return $result;
}

function ws_departmentList() {
  global $sessionId;
  global $client;
  
  $params = array (
    'sessionId' => $sessionId
  );
  $result = $client->__SoapCall('departmentList', array (
    $params
  ));

  if ( !is_array($result->departments) ) {
  	$res = new StdClass();
    $res->departments[0] = $result->departments;
    return $res;
  }
  
  return $result;
}

function ws_roleList() {
  global $sessionId;
  global $client;
  
  $params = array (
    'sessionId' => $sessionId
  );
  $result = $client->__SoapCall('roleList', array (
    $params
  ));
  return $result;
}

function ws_caseList() {
  global $sessionId;
  global $client;
  
  $params = array (
    'sessionId' => $sessionId
  );
  $result = $client->__SoapCall('caseList', array (
    $params
  ));
  return $result;
}

function ws_userList() {
  global $sessionId;
  global $client;
  
  $users = array ();
  $params = array (
    'sessionId' => $sessionId
  );
  $result = $client->__SoapCall('userList', array (
    $params
  ));
  return $result;
}

function ws_triggerList() {
  global $sessionId;
  global $client;
  
  $users = array ();
  $params = array (
    'sessionId' => $sessionId
  );
  $result = $client->__SoapCall('triggerList', array (
    $params
  ));
  return $result;
}

function ws_getCaseInfo($caseId, $delIndex = NULL) {
  global $sessionId;
  global $client;
  
  $params = array (
    'sessionId' => $sessionId,
    'caseId' => $caseId,
    'delIndex' => $delIndex
  );
  $result = $client->__SoapCall('getCaseInfo', array (
    $params
  ));
  return $result;
}

function ws_reassignCase($caseId, $delIndex, $userIdSource, $userIdTarget) {
  global $sessionId;
  global $client;
  
  $params = array (
    'sessionId' => $sessionId,
    'caseId' => $caseId,
    'delIndex' => $delIndex,
    'userIdSource' => $userIdSource,
    'userIdTarget' => $userIdTarget
  );
  $result = $client->__SoapCall('reassignCase', array (
    $params
  ));
  //if ( $result->status_code == 0 ) {
  //  return $result;
  //}
  return $result;
  //throw ( new Exception ( $result->message ) );
}

function ws_taskCase($caseId) {
  global $sessionId;
  global $client;
  
  $params = array (
    'caseId' => $caseId
  );
  //$result = $client->__SoapCall( 'sessionId' => $sessionId, 'taskCase', array($params) );
  //  $result = $client->__SoapCall( 'sessionId' => $sessionId, 'taskCase', array($params) );
  if ($result->status_code == 0) {
    return $result;
  }
  throw (new Exception($result->message));
}

function ws_sendFile($FILENAME, $USR_UID, $APP_UID, $DEL_INDEX = 1, $DOC_UID = NULL, $title = NULL, $comment = NULL) {
  
  $DOC_UID = ($DOC_UID != NULL) ? $DOC_UID : - 1;
  $APP_DOC_TYPE = ($DOC_UID == - 1) ? 'ATTACHED' : 'INPUT';
  $title = ($title != NULL) ? $title : $FILENAME;
  $comment = ($comment != NULL) ? $comment : ''; 
  
  $params = array (
    'ATTACH_FILE' => "@$FILENAME",
    'APPLICATION' => $APP_UID,
    'INDEX' => $DEL_INDEX,
    'USR_UID' => $USR_UID,
    'DOC_UID' => $DOC_UID,
    'APP_DOC_TYPE' => $APP_DOC_TYPE,
    'TITLE' => $title,
    'COMMENT' => $comment
  );
  
  $ch = curl_init();
  curl_setopt($ch, CURLOPT_URL, WS_UPLOAD_URL);
  //curl_setopt($ch, CURLOPT_VERBOSE, 1);
  curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
  curl_setopt($ch, CURLOPT_POST, 1);
  curl_setopt($ch, CURLOPT_POSTFIELDS, $params);
  curl_setopt ($ch, CURLOPT_SSL_VERIFYHOST, 0);
  curl_setopt ($ch, CURLOPT_SSL_VERIFYPEER, 0);
  $response = curl_exec($ch);
  curl_close($ch);
  
  return $response;
}

function ws_updateFile($APP_DOC_UID, $FILENAME, $DOC_VERSION, $APP_DOC_TYPE=NULL, $USR_UID=NULL, $APP_UID=NULL, $DEL_INDEX=NULL, $DOC_UID=NULL, $title=NULL, $comment=NULL) {
  
  $params = array (
    'APP_DOC_UID' => $APP_DOC_UID,
    'DOC_VERSION' => $DOC_VERSION,
    'ATTACH_FILE' => "@$FILENAME"
  );
  
  if( $APP_UID != NULL)
    $params['APPLICATION'] = $APP_UID;
  if( $DEL_INDEX != NULL)
    $params['INDEX'] = $DEL_INDEX;
  if( $USR_UID != NULL)
    $params['USR_UID'] = $USR_UID;
  if( $DOC_UID != NULL)
    $params['DOC_UID'] = $DOC_UID;
  if( $APP_DOC_TYPE != NULL)
    $params['APP_DOC_TYPE'] = $APP_DOC_TYPE;
  if( $title != NULL)
    $params['TITLE'] = $title;
  if( $comment != NULL)
    $params['COMMENT'] = $comment;
  
  $ch = curl_init();
  curl_setopt($ch, CURLOPT_URL, WS_UPLOAD_URL);
  //curl_setopt($ch, CURLOPT_VERBOSE, 1);
  curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
  curl_setopt($ch, CURLOPT_POST, 1);
  curl_setopt($ch, CURLOPT_POSTFIELDS, $params);
  $response = curl_exec($ch);
  curl_close($ch);
  
  return $response;
}

//create a new user
function ws_createUser($userId, $firstname, $lastname, $email, $role, $password) {
  global $sessionId;
  global $client;
  
  $params = array (
    'sessionId' => $sessionId,
    'userId' => $userId,
    'firstname' => $firstname,
    'lastname' => $lastname,
    'email' => $email,
    'role' => $role,
    'password' => $password
  );
  
  $result = $client->__SoapCall('createUser', array (
    $params
  ));
  
  return $result;
}

//create a new group
function ws_createGroup( $groupName ) {
  global $sessionId;
  global $client;
  
  $params = array (
    'sessionId' => $sessionId,
    'name' => $groupName
  );
  $result = $client->__SoapCall('createGroup', array ( $params ));
  return $result;
}

//create a new group
function ws_createDepartment( $depName, $depParentId ) {
  global $sessionId;
  global $client;
  
  $params = array (
    'sessionId' => $sessionId,
    'name' => $depName, 
    'parentUID' => $depParentId
  );
  $result = $client->__SoapCall('createDepartment', array ( $params ));
  return $result;
}

//assignUserToGroup
function ws_assignUserToGroup($userId, $groupId) {
  global $sessionId;
  global $client;
  
  $params = array (
    'sessionId' => $sessionId,
    'userId' => $userId,
    'groupId' => $groupId
  );
  
  $result = $client->__SoapCall('assignUserToGroup', array (
    $params
  ));
  return $result;
}

//assignUserToGroup
function ws_assignUserToDepartment($userId, $depId, $manager ) {
  global $sessionId;
  global $client;
  
  $params = array (
    'sessionId' => $sessionId,
    'userId' => $userId,
    'departmentId' => $depId,
    'manager' => $manager
  );
  
  $result = $client->__SoapCall('assignUserToDepartment', array (
    $params
  ));
  return $result;
}

function ws_systemInformation() {
  global $sessionId;
  global $client;
  
  $params = array (
    'sessionId' => $sessionId
  );
  $result = $client->__SoapCall('systemInformation', array (
    $params
  ));
  return $result;
}

function ws_importProcessFromLibrary($processId, $version = '', $importOption = '', $usernameLibrary = '', $passwordLibrary = '') {
  global $sessionId;
  global $client;
  
  $params = array (
    'sessionId' => $sessionId,
    'processId' => $processId,
    'version' => $version,
    'importOption' => $importOption,
    'usernameLibrary' => $usernameLibrary,
    'passwordLibrary' => $passwordLibrary
  );
  $result = $client->__SoapCall('importProcessFromLibrary', array (
    $params
  ));
  return $result;
}

function ws_InputDocumentList($caseId) {
  global $sessionId;
  global $client;
  
  $params = array (
    'sessionId' => $sessionId,
    'caseId' => $caseId
  );
  
  $result = $client->__SoapCall('InputDocumentList', array (
    $params
  ));
  
  return $result;
}

function ws_outputDocumentList($caseId) {
  global $sessionId;
  global $client;
  
  $params = array (
    'sessionId' => $sessionId,
    'caseId' => $caseId
  );
  
  $result = $client->__SoapCall('outputDocumentList', array (
    $params
  ));
  
  return $result;
}

function ws_removeDocument($appDocUid) {
  global $sessionId;
  global $client;
  
  $params = array (
    'sessionId' => $sessionId,
    'appDocUid' => $appDocUid
  );
  
  $result = $client->__SoapCall('RemoveDocument', array (
    $params
  ));
  
  return $result;
}
